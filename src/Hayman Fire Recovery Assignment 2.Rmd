---
title: "Hayman Fire Recovery"
author: "Matthew Ross"
date: "10/3/2019"
output: html_document
editor_options: 
  chunk_output_type: console
---

```{r setup, warning=F,message=F}
library(tidyverse)
library(tidyr)
library(ggthemes)
library(lubridate)

# Now that we have learned how to munge (manipulate) data
# and plot it, we will work on using these skills in new ways

knitr::opts_knit$set(root.dir='..')
```


```{r dataread, warning=F,message=F}
####-----Reading in Data and Stacking it ----- ####
#Reading in files
files <- list.files('C:/Users/hp/Documents/ESS580/Homework/2_fire_data_wrangle/data',full.names=T)
##'data' will work


#Read in individual data files
ndmi <- read_csv(files[1]) %>% 
  rename(burned=2,unburned=3) %>%
  mutate(data='ndmi')


ndsi <- read_csv(files[2]) %>% 
  rename(burned=2,unburned=3) %>%
  mutate(data='ndsi')

ndvi <- read_csv(files[3])%>% 
  rename(burned=2,unburned=3) %>%
  mutate(data='ndvi')

# Stack as a tidy dataset
full_long <- rbind(ndvi,ndmi,ndsi) %>%
  gather(key='site',value='value',-DateTime,-data) %>%
  filter(!is.na(value))
##new word is called pivot_longer

```




## Question 1) 

What is the correlation between NDVI and NDMI? - here I want you to
convert the full_long dataset in to a wide dataset using the 
function "spread" and then make a plot that shows the correlation s a
function of if the site was burned or not (x axis should be ndmi)
You should exclude winter months and focus on summer months
```{r}

full_wide<-spread(full_long, key='data', value='value')%>%
  mutate(month=month(DateTime))%>%
  filter( month %in% c(5,6,7,8,9))

ggplot(full_wide, aes(x=ndmi, y=ndvi,color=site ))+
  geom_point(shape=1)+
  theme_few()


```
## Question 2 

2) What is the correlation between average NDSI (normalized
 snow index) for January - April and average NDVI for June-August?
In other words, does the previous year's snow cover influence vegetation
 growth for the following summer?
```{r}
full_spread<-spread(full_long, key='data', value='value')%>%
  mutate(year=year(DateTime),month=month(DateTime))%>%
  group_by(site, month)%>%
  summarise(meanNSDI=mean(ndsi%>%
  filter( month %in% c(1,2,3,4))), meanNDVI=mean(ndvi%>%
  filter( month %in% c(7,8,9))))


summer<-spread(full_long, key='data', value='value')%>%
  mutate(year=year(DateTime),month=month(DateTime))%>%
  filter( month %in% c(7,8,9))

winter<-spread(full_long, key='data', value='value')%>%
  mutate(year=year(DateTime),month=month(DateTime))%>%
  filter( month %in% c(1,2,3,4))
  
ggplot(full_spread, aes(x=ndsi, y=ndvi, color=site))
```
## Q3

How is the snow effect from question 2 different between pre- and post-burn
and burned and unburned? 

```{r}

```
## Question 4

What month is the greenest month on average? 

```{r}
monthlygreen<-spread(full_long, key='data', value='value')%>%
  mutate(month=month(DateTime))%>%
  group_by( month)%>%
  summarise(meanNdvi=mean(ndvi, na.rm=TRUE))

Q4<-with(monthlygreen, month[which.max(meanNdvi)])
view(Q4)
```


## Question 5) 

What month is the snowiest on average?
```{r}
snowy<-spread(full_long, key='data', value='value')%>%
  mutate(month=month(DateTime))%>%
  group_by( month)%>%
  summarise(meanNdsi=mean(ndsi, na.rm=TRUE))

Q5<-with(snowy, month[which.max(meanNdsi)])
view(Q5)
```

## Bonus Question: Redo all problems with `spread` and `gather` using modern tidyverse syntax. 
```{r}

```

## Bonus Question: Use Climage Engine to pull the same data for the assignment, but updated with 2020/2021 data.
```{r}

```



